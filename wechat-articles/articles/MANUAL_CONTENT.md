# 从零打造全能公众号助手：Skill 开发三步进化论
## —— 给 AI 小白的第一份 Agent 开发实战手册

**课程目标**：通过“三步走”的进化策略，带领学员从零开始，逐步搭建并升级一个能自动写文、配图、发布的 AI 助手。
**核心理念**：小步快跑，每一步都有正反馈。

---

## 🚀 导读：为什么我们要用“进化论”来学习？

你是否曾经想学 AI 开发，但一看到复杂的代码、环境配置就头大，最后只能“从入门到放弃”？

今天这堂课，我们不讲枯燥的理论，而是带你玩一个**“养成游戏”**。我们将从一个最简单的“文字秘书”开始，一步步给它升级装备，最终把它进化成一个全能的“公众号主编”。

*   **V1.0 纯享版**：5 分钟搞定，让 AI 先学会“写文章”。（难度：★☆☆☆☆）
*   **V2.0 视觉版**：给 AI 装上“眼睛”和“画笔”，让文章图文并茂。（难度：★★☆☆☆）
*   **V3.0 躺平版**：打通最后一公里，一键发布到后台。（难度：★★★☆☆）

准备好了吗？游戏开始！

---

## �️ 准备工作：打造你的 AI 编程工作台

工欲善其事，必先利其器。在本课程中，我们将使用目前最前沿的 AI 编程组合：**Claude Code (CLI 工具) + GLM 4.7 (大模型)**。

*   **Claude Code**：Anthropic 官方推出的命令行编程助手，它能像一个资深程序员一样，直接在你的终端里读代码、写代码、执行命令。
*   **GLM 4.7**：智谱 AI 推出的国产最强旗舰模型，逻辑推理能力强，且性价比极高，完美适配中文语境的开发任务。

### 0.1 安装 Claude Code
首先，确保你的电脑已经安装了 Node.js（建议版本 v18 以上）。
打开终端，输入以下命令进行安装：

```bash
npm install -g @anthropic-ai/claude-code
```

### 0.2 配置 GLM 4.7 模型

#### 方式一：使用 ccr ui 可视化配置（推荐）

如果你觉得命令行操作太抽象，可以使用 `ccr ui` 命令进行交互式配置，非常直观：

1.  **启动配置工具**：
    在终端输入以下命令：
    ```bash
    ccr ui
    ```

2.  **选择模型供应商**：
    在弹出的界面中，使用方向键选择 **OpenAI Compatible**（因为 GLM 兼容 OpenAI 协议），然后按回车。

官方地址：https://docs.bigmodel.cn/cn/guide/models/text/glm-4.7

3.  **填写 API 信息**：
    *   **Base URL**: 输入智谱 AI 的接口地址：`https://open.bigmodel.cn/api/paas/v4/`
    *   **API Key**: 粘贴你在智谱开放平台获取的 API Key（例如 `123456...`）。
    *   **Model Name**: 输入 `glm-4.7`

    ![alt text](image.png)

4.  **保存并退出**：
    确认信息无误后，选择 Save 保存。

#### 方式二：命令行环境变量配置（极客风）

Claude Code 默认连接 Anthropic 的模型，但我们可以通过配置让它连接到兼容 OpenAI 格式的 GLM 4.7。

1.  **获取 API Key**：前往 [智谱 AI 开放平台](https://bigmodel.cn/) 注册并获取 API Key。
2.  **配置环境变量**：在你的终端中运行以下命令（Windows 用户请使用 set）：

```bash
export OPENAI_BASE_URL=https://open.bigmodel.cn/api/paas/v4/
export OPENAI_API_KEY=你的_GLM_API_KEY
```

3.  **启动 Claude Code**：
    现在，你可以启动它了。在终端输入：
    ```bash
    claude
    ```
    当看到欢迎界面时，说明你的 AI 编程助手已经就位！接下来，我们就用它来帮我们从零写代码。

#### 方式三：故障排查（重要）

如果你在使用 `ccr code --model glm-4.7` 启动后依然报错 `API Error: 400 {"error":"Missing model in request body"}`，这通常是因为 Claude Code 内部配置覆盖了命令行参数，或者 `ccr` 的配置没有正确生效。

**终极解决方案**：直接使用 Claude Code 的原生配置命令，强制覆盖。

1.  **直接修改 Claude 配置文件**：
    运行以下命令，强制将 GLM-4 配置写入 Claude 的配置文件（注意：请确保替换 `<你的API_KEY>`）：

    ```bash
    # 设置 API Key
    claude config set -g anthropicApiKey <你的_GLM_API_KEY>
    
    # 强制设置 Base URL（这一步很关键）
    export ANTHROPIC_BASE_URL="https://open.bigmodel.cn/api/paas/v4/"
    
    # 启动时再次指定模型（确保万无一失）
    claude --model glm-4
    ```

2.  **检查是否生效**：
    在 Claude 交互界面中输入 `/config`，检查 `model` 字段是否为 `glm-4`。

如果以上方法仍然无效，可能是 `ccr` 工具与当前版本的 `claude-code` 存在兼容性问题，建议卸载 `ccr` 并直接使用 `claude` 命令进行配置。

---

## 📝 第一阶段：V1.0 纯享版 —— 打造最强“文字秘书”

**目标**：输入一个主题，AI 自动写出一篇结构完美、金句频出的 Markdown 文章。
**耗时**：约 10-15 分钟
**核心技能**：Prompt 工程

### 1.1 什么是 Skill？（简单理解）

想象一下，你雇了一个实习生（AI）。
*   如果你什么都不教他，他只能陪你聊聊天，问问天气。
*   如果你给他一份详细的**“岗位说明书”**（Skill），告诉他：“你是编辑，文章要这么写，开头要这样，结尾要那样……”他就能帮你干活了。

**Skill 就是这份“岗位说明书”。**

### 1.1.1 进阶：Skill 的“三层大脑”（渐进式披露）

为了让 AI 变得更聪明且不“死记硬背”，我们设计了一种**“渐进式披露”**的结构。你可以把它想象成 AI 的记忆宫殿：

1.  **第一层：元数据层 (Metadata) —— “名片”**
    *   **包含内容**：Skill 的**名称**和**描述**。
    *   **加载机制**：**始终加载**。
    *   **作用**：就像应用的图标和简介。AI 会一直把这部分信息记在脑子里，用来判断“用户现在的需求，我是不是该调用这个 Skill？”

2.  **第二层：指令层 (Instruction) —— “操作手册”**
    *   **包含内容**：`SKILL.md` 文件中除了名称和描述之外的所有内容（即 Prompt、具体操作步骤、规则）。
    *   **加载机制**：**按需加载**。
    *   **作用**：就像详细的操作手册。只有当 AI 决定“我要用这个 Skill 了”，它才会去把这本厚厚的手册拿出来细读，学习具体怎么干活。

3.  **第三层：资源层 (Resource) —— “工具箱”**
    *   **包含内容**：引用的外部文件，如 **Reference**（参考文档）和 **Script**（Python/Shell 脚本）。
    *   **加载机制**：**按需中的按需加载**。
    *   **作用**：就像工具箱里的特殊工具。只有当操作手册（指令层）里写着“现在需要运行这个脚本”或者“请参考那个文档”时，AI 才会去读取这些具体的文件。

**总结**：平时只记“名字”，用的时候才看“说明书”，干活的时候才拿“锤子”。这种设计保证了 AI 的大脑（上下文窗口）不会被撑爆，也能在很大程度上降低 AI 使用的 token 量，帮助我们尽量节俭的完成工作任务。

### 1.2 实战：编写你的第一份“岗位说明书”

在你的 IDE 中，创建一个文件夹 `wechat-article-generator`，并在里面新建一个文件 `SKILL.md`。

把下面的内容复制进去。这就是你给 AI 的第一道指令：

```markdown
---
name: "wechat-article-generator"
description: "公众号爆款文章生成器，自动撰写深度好文。"
---

# 角色定义
你是一名拥有10年经验的公众号主编“伍六七”。你的文风犀利、接地气，拒绝爹味说教。

# 写作模板
请严格按照以下结构生成文章：

1. **【标题】**：要扎心，要反常识。例如《月薪3000的快乐，你想象不到》。
2. **【开场白】**：固定使用“hi，我是伍六七。”，然后用一个场景或故事快速切入。
3. **【正文】**：
   - 分为3个小标题。
   - 多用短句，多用“你”、“我”拉近距离。
   - 必须包含至少2个金句。
4. **【结尾】**：总结全文，并引导关注。

# 输出要求
请直接输出 Markdown 格式的内容。
```

### 1.3 见证奇迹：第一次运行

现在，在 IDE 的对话框里，直接输入：

> “写一篇关于‘程序员35岁危机’的文章，使用 wechat-article-generator skill”

**看！** AI 就像被魂穿了一样，不再是那个只会说“你好”的机器人，而是变成了一个犀利的主编，洋洋洒洒写出了一篇有模有样的文章。

**恭喜你！V1.0 版本达成！** 你现在已经拥有了一个 24 小时待命的写作助手。

---

## 🎨 第二阶段：V2.0 视觉版 —— 升级为“图文主编”

**目标**：文章不仅要有字，还要有 AI 自动生成的配图。
**耗时**：约 30-40 分钟
**核心技能**：Python 脚本、API 调用

### 2.1 痛点：光有文字不够看

V1.0 虽然好用，但在这个读图时代，纯文字没人看。而且，去网上找图又怕侵权，自己画又不会。
怎么办？**让 AI 帮我们画！**

### 2.2 进化：给 AI 装上“画笔”

我们需要写一段 Python 代码，告诉电脑：“读完文章后，根据内容画几张图。”

在文件夹里新建 `scripts/generate_images.py`。我们这里使用阿里云的**通义万相**（Qwen）模型，因为它便宜又好用。

*(此处展示核心代码逻辑，详细代码见附录)*
```python
# 伪代码演示
prompt = "一个程序员在深夜加班，窗外是繁华的城市夜景，赛博朋克风格"
image_url = call_qwen_api(prompt)  # 调用阿里云 API
save_to_local(image_url, "cover.png") # 保存到本地
```

### 2.3 进化：给 AI 装上“搬运工”

图片有了，但还躺在你的电脑硬盘里。微信公众号是不认本地图片的，你必须把它传到互联网上，生成一个链接。
这就需要**图床**。我们用免费又稳定的 **GitHub** 来做图床。

新建 `scripts/upload_images.py`：
```python
# 伪代码演示
upload_to_github("cover.png")
return "https://yourname.github.io/images/cover.png" # 拿到链接
```

### 2.4 成果验收

现在，再次运行指令：
> “写一篇关于‘未来城市’的文章，要配图”

你会发现，文章里不仅有文字，还插入了 AI 刚刚画好的、充满科技感的插图。文章的档次瞬间提升了！

---

## 📨 第三阶段：V3.0 躺平版 —— 成为“全栈运营”

**目标**：连复制粘贴都省了，直接推送到公众号草稿箱。
**耗时**：约 20 分钟
**核心技能**：自动化接口

### 3.1 痛点：最后一步最烦人

虽然文章好了，图也有了，但还要登录微信后台、扫码、复制、调整格式……这一步最消磨热情。
能不能让 AI 把这最后一步也代劳了？

### 3.2 终极进化：打通“最后一公里”

微信其实给开发者开了“后门”（API 接口）。我们可以写一个脚本，伪装成浏览器，把文章“快递”进去。

新建 `scripts/publish_article.py`。你需要去微信公众号后台获取 `AppID` 和 `AppSecret`。

```python
# 伪代码演示
article = load_final_article()
wechat_api.push_draft(article) # 一键推送
print("发布成功！去手机上预览吧！")
```

### 3.3 安全第一：保护你的秘密 (.env)

**注意！** 你的 API Key 和密码千万不能写在代码里，万一发给别人看就泄露了。
我们要创建一个 `.env` 文件，把这些秘密都锁在里面：

```ini
ALI_API_KEY=sk-xxxxxx
GITHUB_TOKEN=ghp-xxxxxx
WX_APPID=wx123456
```

### 3.4 最终验收：High Moment

深吸一口气，输入终极指令：
> “写一篇‘猫咪的职场生存法则’，配萌宠图，直接发布”

接下来，你会看到 IDE 疯狂输出日志：
*   ✅ 文章生成完毕...
*   ✅ 图片绘制完毕...
*   ✅ 图片上传完毕...
*   🚀 **正在推送至微信... 发布成功！**

此时，你的手机微信“叮”了一声。打开订阅号助手，那篇图文并茂的文章已经静静地躺在草稿箱里了。

**这一刻，你不再是一个普通的 AI 用户，你是一个真正的 AI Agent 开发者！**

---

## 🎁 结语

从 V1 到 V3，我们像搭积木一样，把一个简单的想法变成了一个强大的工具。

*   **V1** 让你学会了如何指挥 AI。
*   **V2** 让你学会了如何利用工具（API）。
*   **V3** 让你学会了如何构建系统（自动化）。

这只是开始。你还可以给它接上新闻接口让它追热点，接上定时任务让它每天早上 8 点自动发文……AI 的上限，只取决于你的想象力。

**快去动手试试吧！**
